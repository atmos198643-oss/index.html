<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <style>
        body { background: #000; color: #fff; font-family: sans-serif; margin: 0; padding: 20px; overflow: hidden; }
        .grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; height: 92vh; }
        .card { 
            background: #111; border: 2px solid #333; border-radius: 20px; 
            display: flex; flex-direction: column; align-items: center; 
            justify-content: space-around; padding: 15px; transition: 0.8s;
        }
        .active { border-color: #ffcc00; transform: scale(1.05); box-shadow: 0 0 30px rgba(255,204,0,0.2); }
        .img-box { width: 100%; height: 60%; display: flex; justify-content: center; align-items: center; background: #050505; border-radius: 15px; }
        img { max-width: 95%; max-height: 95%; object-fit: contain; }
        .name { font-size: 1.6vw; font-weight: bold; text-align: center; }
        .price { font-size: 2.2vw; color: #ffcc00; font-weight: 900; }
    </style>
</head>
<body>
    <div id="board" class="grid">СИНХРОНИЗАЦИЯ...</div>

    <script>
        const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQkJg-ateJ916_iAnG4ZUigWnVAh5Rhm0j7wutgrkf2Kl71EIckZiuwcZ4rvs8qEqTqfFEJHwaMdyZc/pub?output=csv";

        async function update() {
            try {
                // Добавляем уникальный ключ к запросу, чтобы Google не выдавал старье
                const response = await fetch(sheetUrl + "&cachebuster=" + Date.now());
                const data = await response.text();
                const rows = data.split('\n').map(row => row.split(','));

                let html = "";
                for (let i = 1; i <= 12; i++) {
                    const row = rows[i];
                    if (row && row[1]) {
                        const name = row[1].replace(/"/g, "");
                        const price = row[2].replace(/"/g, "");
                        const img = (row[3] || "").replace(/"/g, "").trim();

                        html += `
                        <div class="card" id="c${i}">
                            <div class="img-box">
                                <img src="${img}" loading="lazy" onerror="this.src='https://via.placeholder.com/300/111/444?text=IMAGE+LOADING...'">
                            </div>
                            <div class="name">${name}</div>
                            <div class="price">${price} €</div>
                        </div>`;
                    }
                }
                document.getElementById("board").innerHTML = html;
            } catch (err) { console.error("Ошибка обновления"); }
        }

        // Переключение активной карточки
        let cur = 1;
        setInterval(() => {
            const cards = document.querySelectorAll('.card');
            if (cards.length) {
                cards.forEach(c => c.classList.remove('active'));
                const target = document.getElementById('c' + cur);
                if (target) target.classList.add('active');
                cur = (cur % cards.length) + 1;
            }
        }, 5000); // 5 секунд на один товар

        // Обновляем данные из таблицы РЕДКО (раз в минуту), чтобы не злить Google
        update();
        setInterval(update, 60000); 
    </script>
</body>
</html>
